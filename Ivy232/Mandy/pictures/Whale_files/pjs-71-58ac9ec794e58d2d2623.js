webpackJsonp([71],{DOck:function(e,t){function n(){}e.exports=n},"Esb+":function(e,t,n){function r(e,t){return a(e,t)}var a=n("tTch");e.exports=r},Exm5:function(e,t,n){function r(e){return e&&e.length?a(e):[]}var a=n("ncdy");e.exports=r},Xafg:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){var t=e.name,n=e.upwtActionName,r=e.resourceDependencies,a=void 0===r?function(){return[]}:r,o=e.routeContextLog,l=void 0===o?function(e,t,n){return null}:o,p=e.metatagResource,h=void 0===p?function(){return null}:p,d=e.placementId,f=void 0===d?null:d,g=e.redirect,y=void 0===g?function(){return null}:g,v=e.getRenderError,w=void 0===v?function(){return null}:v;return function e(r){var o,p;return p=o=function(e){function t(){return i(this,t),s(this,e.apply(this,arguments))}return c(t,e),t.prototype.render=function e(){var t=this.props,n=t.params,a=t.location,o=void 0===a?{}:a,i=(this.props.route||{}).legacy_server_context;return u.a.createElement(m,{log:l(i||{},n||{},o||{})},u.a.createElement(r,this.props))},t}(u.a.Component),o.displayName="StaticRouteData",o.WrappedComponent=r,o.routeName=t,o.upwtActionName=n,o.getResourceDependencies=a,o.getContextLog=l,o.getMetatagResource=h,o.placementId=f,o.getRedirect=y,o.getRenderError=w,p}}var p=n("OVW8"),u=n.n(p),h=n("WjSu"),d=n("hVsM"),f=n("SnoN"),m=function(e){function t(){return r(this,t),a(this,e.apply(this,arguments))}return o(t,e),t.prototype.componentDidMount=function e(){var t=this.props.log;if(t){var n=d.a.fromPlainObject(t);n.setEventType(13),n.setRequestIdentifier(h.a.initialPageContext.PAGE_LOAD_REQUEST_IDENTIFIER),f.a.getInstance().addEvent(n)}},t.prototype.render=function e(){return this.props.children},t}(p.Component),g=n("9FEF");t.a=l},adgJ:function(e,t,n){"use strict";function r(e){var t=e.showAsModal,n=e.params,r=e.location,a=e.router,i=n.id,c=r.query,l=parseInt(c.variant_id,10),p=parseInt(c.catalog_id,10),h=parseInt(c.x,10),d=parseInt(c.y,10),f=parseInt(c.w,10),m=parseInt(c.h,10);return o.a.createElement(s.a,{isAnimated:"1"===c.animation,replaceState:function e(){return a.replace.apply(a,arguments)},goBack:function e(){return a.goBack()},showAsModal:t,pinId:i,productImageIndex:u(l,p)?{variantId:l,catalogId:p}:void 0,initialCropArea:u(h,d,f,m)?{x:h,y:d,w:f,h:m}:void 0,inDenzelModal:!1,inPureReact:!0})}Object.defineProperty(t,"__esModule",{value:!0});var a=n("OVW8"),o=n.n(a),i=n("DUIN"),s=n("r7qI"),c=n("Xafg"),l=n("MQ2h"),p=n.n(l),u=function e(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.every(function(e){return!isNaN(e)})};t.default=Object(l.compose)(Object(c.a)({name:"Flashlight",resourceDependencies:function e(t,n){return[{name:"PinResource",options:{id:n.id,field_set_key:"detailed",fetch_visual_search_objects:!0}}]}}),Object(i.connect)(function(e){return{showAsModal:e.location.history.length>1}}))(r)},gMBz:function(e,t,n){var r=n("sVTc"),a=n("DOck"),o=n("o9Bl"),i=1/0,s=r&&1/o(new r([,-0]))[1]==1/0?function(e){return new r(e)}:a;e.exports=s},ncdy:function(e,t,n){function r(e,t,n){var r=-1,u=o,h=e.length,d=!0,f=[],m=f;if(n)d=!1,u=i;else if(h>=p){var g=t?null:c(e);if(g)return l(g);d=!1,u=s,m=new a}else m=t?[]:f;e:for(;++r<h;){var y=e[r],v=t?t(y):y;if(y=n||0!==y?y:0,d&&v===v){for(var w=m.length;w--;)if(m[w]===v)continue e;t&&m.push(v),f.push(y)}else u(m,v,n)||(m!==f&&m.push(v),f.push(y))}return f}var a=n("vRa5"),o=n("JmUs"),i=n("6Hh8"),s=n("u923"),c=n("gMBz"),l=n("o9Bl"),p=200;e.exports=r},r7qI:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function h(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g=n("OVW8"),y=n.n(g),v=n("SnoN"),w=n("GGB8"),b=n.n(w),C=n("kz20"),x=n("IaRT"),O=n.n(x),E=n("Kqaz"),_=n("MQ2h"),S=n.n(_),M=n("JKYN"),I=function(e){function t(n){r(this,t);var o=a(this,e.call(this,n)),i=n.searchResultMetaData&&n.searchResultMetaData.search_identifier;return i&&n.onSearchIdUpdate(i),o}return o(t,e),t.prototype.componentWillReceiveProps=function e(t){var n=t.searchResultMetaData,r=this.props.searchResultMetaData,a=r&&r.search_identifier,o=n&&n.search_identifier;a!==o&&this.props.onSearchIdUpdate(o)},t.prototype.render=function e(){var t=this.props,n=t.contextLog,r=t.onAdd,a=t.onRemove,o=t.searchResultMetaData,i=0,s=o&&o.search_identifier,c=o?[].concat(o.query_filters.map(function(e){return{label:e,selected:!0}}),o.annotations.map(function(e){return{label:e,selected:!1}})):[];return y.a.createElement("div",{className:"flashlightAnnotationList"},c.map(function(e){var t=e.selected,o=e.label,c={};return t||(c.backgroundColor=C.a[i%C.a.length],i+=1),y.a.createElement("div",{key:o,className:"flashlightAnnotationListItem"},y.a.createElement("button",{className:b()({selected:t}),onClick:function e(i){n(101,{viewData:{search_identifier:s},component:4,element:1032,annotation_type:t?"remove":"add",search_identifier:s,label:o}),i.stopPropagation(),(t?a:r)(o)},type:"button",style:c},y.a.createElement("span",null,o)))}))},t}(g.Component),A=Object(_.compose)(E.a,Object(M.b)({name:"VisualLiveSearchResource",options:function e(t){return t.resourceOptions},key:"searchResultMetaData"}))(I),R=y.a.createElement("div",null,y.a.createElement("div",{className:"cropperHandle absolute ord-nw"}),y.a.createElement("div",{className:"cropperHandle absolute ord-ne"}),y.a.createElement("div",{className:"cropperHandle absolute ord-sw"}),y.a.createElement("div",{className:"cropperHandle absolute ord-se"})),D=function(e){function t(){var n,r,a;i(this,t);for(var o=arguments.length,c=Array(o),l=0;l<o;l++)c[l]=arguments[l];return n=r=s(this,e.call.apply(e,[this].concat(c))),r.state={cropArea:r.props.initialCropArea||{h:0,w:0,x:0,y:0},cropChangeType:null,showShadowOverlay:!0},r.cropResizeDirection=null,r._checkCropHandleValid=function(e,t){var n=r.state.cropArea,a=n.h,o=n.w,i=n.x,s=n.y;switch(r.cropResizeDirection){case"ne":e<i&&t>s+a?r.cropResizeDirection="sw":e<i?r.cropResizeDirection="nw":t>s+a&&(r.cropResizeDirection="se");break;case"nw":e>i+o&&t>s+a?r.cropResizeDirection="se":e>i+o?r.cropResizeDirection="ne":t>s+a&&(r.cropResizeDirection="sw");break;case"se":e<i&&t<s?r.cropResizeDirection="nw":e<i?r.cropResizeDirection="sw":t<s&&(r.cropResizeDirection="ne");break;case"sw":e>i+o&&t<s?r.cropResizeDirection="ne":e>i+o?r.cropResizeDirection="se":t<s&&(r.cropResizeDirection="nw")}},r.handleOnTouchStart=function(e){if(e.preventDefault(),e.stopPropagation(),e.target){var t=e.touches[0],n=t.clientX,a=t.clientY;r.handleOnPointerDown(e,n,a)}},r.handleOnMouseDown=function(e){if(e.preventDefault(),e.stopPropagation(),e.target){var t=e.clientX,n=e.clientY;r.handleOnPointerDown(e,t,n)}},r.handleOnPointerDown=function(e,t,n){var a=e.target,o=r.state.showShadowOverlay,i=r._cropperOverlay.getBoundingClientRect();r._cropperOverlayCoor={x:i.left,y:i.top};var s=t-r._cropperOverlayCoor.x,c=n-r._cropperOverlayCoor.y;if(a.className.includes("cropperHandle")){r.setState({cropChangeType:"resize"});var l=a.className;l.includes("ne")&&(r.cropResizeDirection="ne"),l.includes("nw")&&(r.cropResizeDirection="nw"),l.includes("se")&&(r.cropResizeDirection="se"),l.includes("sw")&&(r.cropResizeDirection="sw")}else a.className.includes("cropSection")?(r.setState({cropChangeType:"move"}),r.cropChangeStartCoor={x:s,y:c}):!a.className.includes("shadowMask")&&o||(r.cropChangeStartCoor={x:s,y:c},r.setState({cropArea:{h:0,w:0,x:s,y:c},cropChangeType:"select",showShadowOverlay:!0}))},r.handleOnTouchMove=function(e){return r._cropperOverlayCoor&&r.handleOnPointerMove(e.touches[0].clientX,e.touches[0].clientY)},r.handleOnMouseMove=function(e){return r._cropperOverlayCoor&&r.handleOnPointerMove(e.clientX,e.clientY)},r.handleOnPointerMove=function(e,t){var n=r.state,a=n.cropArea,o=a.h,i=a.w,s=a.x,c=a.y,l=n.cropChangeType,p=r.props.imageSize,u=e-r._cropperOverlayCoor.x,h=t-r._cropperOverlayCoor.y;if("resize"===l){var d=Math.max(Math.min(u,p.w),0),f=Math.max(Math.min(h,p.h),0);switch(r._checkCropHandleValid(d,f),r.cropResizeDirection){case"ne":r.setState({cropArea:{h:o+(c-f),w:Math.abs(d-s),x:s,y:f}});break;case"nw":r.setState({cropArea:{h:o+(c-f),w:i+(s-d),x:d,y:f}});break;case"se":r.setState({cropArea:{h:Math.abs(f-c),w:Math.abs(d-s),x:s,y:c}});break;case"sw":r.setState({cropArea:{h:Math.abs(f-c),w:i+(s-d),x:d,y:c}})}}else if("move"===l){var m=u-r.cropChangeStartCoor.x,g=h-r.cropChangeStartCoor.y,y=Math.max(Math.min(s+m,p.w-i),0),v=Math.max(Math.min(c+g,p.h-o),0);r.cropChangeStartCoor={x:u,y:h},r.setState({cropArea:{h:o,w:i,x:y,y:v}})}else if("select"===l){var w=Math.max(Math.min(u,p.w),0),b=Math.max(Math.min(h,p.h),0),C=w-r.cropChangeStartCoor.x,x=b-r.cropChangeStartCoor.y;r.setState({cropArea:{h:Math.abs(x),w:Math.abs(C),x:Math.min(r.cropChangeStartCoor.x,w),y:Math.min(r.cropChangeStartCoor.y,b)}})}},r.handleOnMouseUp=function(e){return r.handleOnPointerUp()},r.handleOnTouchEnd=function(e){return r.handleOnPointerUp()},r.handleOnPointerUp=function(){var e=r.state.cropChangeType;"resize"!==e&&"move"!==e&&"select"!==e||r.handleCrop(),r.cropResizeDirection=null},a=n,s(r,a)}return c(t,e),t.prototype.componentDidMount=function e(){this._cropperOverlay&&document.body&&(window.addEventListener("mouseup",this.handleOnMouseUp),document.body.addEventListener("mousemove",this.handleOnMouseMove),this._cropperOverlay.addEventListener("mousedown",this.handleOnMouseDown))},t.prototype.componentWillReceiveProps=function e(t){t.initialCropArea&&(this.props.initialCropArea&&t.initialCropArea.h===this.props.initialCropArea.h&&t.initialCropArea.w===this.props.initialCropArea.w&&t.initialCropArea.x===this.props.initialCropArea.x&&t.initialCropArea.y===this.props.initialCropArea.y||this.setState({cropArea:t.initialCropArea}))},t.prototype.componentWillUnmount=function e(){this._cropperOverlay&&document.body&&(window.removeEventListener("mouseup",this.handleOnMouseUp),document.body.removeEventListener("mousemove",this.handleOnMouseMove),this._cropperOverlay.removeEventListener("mousedown",this.handleOnMouseDown))},t.prototype.handleCrop=function e(){var t=this.props,n=t.imageSize,r=t.onChange,a=this.state.cropArea;0===a.w&&0===a.h?(this.setState({showShadowOverlay:!1,cropChangeType:null}),r({crop:{h:1,w:1,x:0,y:0},origCrop:{h:n.h,w:n.w,x:0,y:0}})):(this.setState({showShadowOverlay:!0,cropChangeType:null}),r({crop:{h:a.h/n.h,w:a.w/n.w,x:a.x/n.w,y:a.y/n.h},origCrop:Object.assign({},a)}))},t.prototype.render=function e(){var t=this,n=this.props,r=n.imageSize,a=r.h,o=r.w,i=n.children,s=this.state,c=s.cropArea,l=c.h,p=c.w,u=c.x,h=c.y,d=s.cropChangeType,f=s.showShadowOverlay,m=b()("shadowOverlay","absolute",{shadowOverlayHide:!f});return y.a.createElement("div",{onTouchMove:this.handleOnTouchMove,onTouchEnd:this.handleOnTouchEnd},y.a.createElement("div",{className:"cropperWrapper block"},y.a.createElement("div",{className:"relative",ref:function e(n){t._cropperOverlay=n},onTouchStart:this.handleOnTouchStart},y.a.createElement("div",{className:"cropSection absolute",style:{height:l,left:u,top:h,width:p}},"select"!==d&&f&&R),y.a.createElement("div",{className:m},y.a.createElement("div",{className:"shadowMask absolute",style:{height:h,left:0,top:0,width:"100%"}}),y.a.createElement("div",{className:"shadowMask absolute",style:{height:l,left:0,top:h,width:u}}),y.a.createElement("div",{className:"shadowMask absolute",style:{height:a-h-l,left:0,top:h+l,width:"100%"}}),y.a.createElement("div",{className:"shadowMask absolute",style:{height:l,left:u+p,top:h,width:o-u-p}})),y.a.createElement("div",{className:"absolute cropperAdditional"},i))))},t}(y.a.Component),j=n("gEaE"),z=4,T=15,N=function e(t,n){return Object.keys(t).reduce(function(e,r){return e+Math.abs(t[r]-n[r])},0)<=4},P=function e(t){var n=t.cropArea,r=t.imageSize,a=n.h,o=n.w,i=n.x,s=n.y;return{h:Math.floor(a*r.h),w:Math.floor(o*r.w),x:Math.floor(i*r.w),y:Math.floor(s*r.h)}},k=function(e){function t(n){l(this,t);var r=p(this,e.call(this,n));L.call(r);var a=r.props,o=a.imageSize,i=a.initialCropArea,s=a.spotlightAreas.findIndex(function(e){return N(i,P({cropArea:e,imageSize:o}))});return r.state={currentSpotlightIdx:s},r}return u(t,e),t.prototype.componentWillReceiveProps=function e(t){var n=t.imageSize,r=t.initialCropArea,a=t.spotlightAreas.findIndex(function(e){return N(r,P({cropArea:e,imageSize:n}))});this.setState({currentSpotlightIdx:a})},t.prototype.render=function e(){var t=this,n=this.props,r=n.imageSize,a=n.initialCropArea,o=n.spotlightAreas,i=o&&!!o.length;return y.a.createElement(D,{imageSize:r,initialCropArea:a,onChange:this.handleChange},i&&y.a.createElement("div",{className:"spotlightWrapper absolute",style:{width:r.w}},o.map(function(e,n){return t.renderSpotlightDot(e,n)})))},t}(g.Component);k.defaultProps={spotlightAreas:[]};var L=function e(){var t=this;this.handleChange=function(e){(0,t.props.onChange)(e)},this.handleSpotlightClick=function(e){var n=t.props,r=n.imageSize,a=n.onChange,o=n.spotlightAreas,i=P({cropArea:o[e],imageSize:r});a({crop:o[e],origCrop:i})},this.renderSpotlightDot=function(e,n){var r=t.state.currentSpotlightIdx;if(n===r)return null;var a=t.props.imageSize,o=P({cropArea:e,imageSize:a}),i={x:o.x+o.w/2,y:o.y+o.h/2};return y.a.createElement("button",{className:"absolute no-border p0 spotlightButton",key:n,onClick:function e(r){r&&(r.stopPropagation(),r.preventDefault()),t.handleSpotlightClick(n)},style:{left:i.x,top:i.y}},y.a.createElement(j.t,{height:15,shape:"circle",width:15},y.a.createElement("div",{className:"spotlightDot bg-white",style:{height:15,width:15}})))}},F=k,U=n("W/Cr"),V=n("lWtR"),W=n("ULUT"),B=n("LQXo"),H={__style:{top:-14}},q={__style:{top:6}},X=function e(t,n){var r=t.fetchMoreData,a=t.inDenzelModal,o=t.isFetching,i=t.pins,s=t.resourceOptions.image_signature,c=t.scrollContainer,l=t.searchId,p=n.userAgent.isMobile;return y.a.createElement(j.b,null,i&&l&&y.a.createElement(j.b,{position:"relative",dangerouslySetInlineStyle:p?q:H},y.a.createElement(j.u,{columnWidth:Object(B.d)(p),comp:function e(t){var n=t.data,r=t.itemIdx;return y.a.createElement(j.b,{deprecatedPadding:p?0:{x:2,y:4}},y.a.createElement(V.a,{pin:n,inDenzelModal:a,slotIndex:r,showEditPinButton:!1,showLikeItButton:!0,contextLogData:{viewData:{search_identifier:l},search_identifier:l,image_signature:s},viewType:72,viewParameter:3050}))},gutterWidth:Object(B.b)(p),items:i,loadItems:r,minCols:1,scrollContainer:function e(){return c||window}})),y.a.createElement(j.D,{accessibilityLabel:U.a._("Loading search results...","Accessibility label for loading visual search results"),show:o||!l}))},Y=O.a.shape({addEventListener:O.a.func,removeEventListener:O.a.func});X.contextTypes={userAgent:O.a.shape({isMobile:O.a.bool.isRequired}).isRequired};var G=Object(_.compose)(Object(M.b)({name:"VisualLiveSearchResultResource",options:function e(t){return t.resourceOptions},key:"pins"}))(X),J=n("Esb+"),Q=n.n(J),K=n("vCSV"),Z=n("Cjb7"),$=n("nX0T"),ee=n("Exm5"),te=n.n(ee),ne=n("aGt6"),re=564,ae=64,oe=80,ie=20,se=400,ce=function e(t,n,r){var a=t.x,o=t.y,i=t.w,s=t.h,c=[];if(r){var l=r.variantId,p=r.catalogId;c=c.concat(["variant_id="+l,"catalog_id="+p])}return a>=0&&o>=0&&i>=0&&s>=0&&(c=c.concat(["x="+a,"y="+o,"w="+i,"h="+s])),"/pin/"+n+"/visual-search/"+(c.length?"?"+c.join("&"):"")},le=function e(t){var n=t.pin,r=t.productImageIndex,a=n.images,o=n.image_signature;if(r&&n.buyable_product){var i=r.variantId,s=r.catalogId,c=n.buyable_product.items[i];if(c){var l=c.images[s];l&&(a=l.canonical_images,o=l.image_signature)}}var p=a["564x"]&&a.orig,u=p.url,h=p.width,d=p.height;return h>564&&(d*=564/h,h=564),{width:h,height:d,url:u,imageSignature:o}},pe=function e(t){var n=t.initialCropArea,r=t.pin,a=t.productImageIndex,o=void 0;if(n)o=Object.assign({},n);else{var i=r.visual_objects,s=le({pin:r,productImageIndex:a}),c=s.width,l=s.height;if(i&&i.length){var p=i[0],u=p.x,h=p.y,d=p.w,f=p.h,m=[u*c,h*l,d*c,f*l];o={x:u=m[0],y:h=m[1],w:d=m[2],h:f=m[3]}}else{var g=c/6,y=l/6;o={x:g,y:y,w:c-2*g,h:l-2*y}}}return{x:Math.floor(o.x),y:Math.floor(o.y),w:Math.floor(o.w),h:Math.floor(o.h)}},ue=function(e){function t(){var n,r,a;d(this,t);for(var o=arguments.length,i=Array(o),s=0;s<o;s++)i[s]=arguments[s];return n=r=f(this,e.call.apply(e,[this].concat(i))),r.state={animationState:r.props.isAnimated?"initial":"finished",searchId:"",textFilters:[]},r.getResourceOptions=function(e,t,n){var a=r.props.pin,o=a.image_signature,i=a.id,s=r.state.textFilters;return{pin_id:i,image_signature:o,crop:{x:e.x/t,y:e.y/n,w:e.w/t,h:e.h/n},text_filters:s,keep_duplicates:!1}},r.handleCropperChange=function(e){var t=e.origCrop,n=r.props,a=n.pin,o=n.productImageIndex,i=n.replaceState,s=ce(t,a.id,o);s!==window.location.pathname+window.location.search&&i(s)},r.renderContentForMobile=function(){var e=r.props,t=e.initialCropArea,n=e.isAnimated,a=e.pin,o=e.productImageIndex,i=le({pin:a,productImageIndex:o}),s=i.width,c=i.height,l=i.url,p=pe({initialCropArea:t,pin:a,productImageIndex:o}),u=r.getResourceOptions(p,s,c);return y.a.createElement($.a,{view:72,objectId:r.state.searchId},y.a.createElement(j.b,null,y.a.createElement(j.b,{display:"flex",justifyContent:"center",deprecatedMargin:{top:1,bottom:1}},y.a.createElement(j.m,{size:"sm"},U.a._("Visually similar results"))),y.a.createElement(j.b,null,y.a.createElement(j.b,{display:"flex",justifyContent:"center",deprecatedMargin:{top:1,bottom:1}},y.a.createElement("div",{className:"FlashlightEnabledImage",style:{width:s,height:c}},y.a.createElement(j.t,{height:c,shape:"rounded",width:s},y.a.createElement(F,{imageSize:{h:c,w:s},initialCropArea:p,isAnimated:n,onChange:r.handleCropperChange,spotlightAreas:a.visual_objects}),y.a.createElement(K.a,{alt:a.description,className:"pinImage rounded",src:l,width:s})))),y.a.createElement(j.b,null,y.a.createElement("div",{className:"flashlightResultsContainer"},y.a.createElement(j.b,null,y.a.createElement(A,{onAdd:function e(t){return r.setState({textFilters:te()(r.state.textFilters.concat([t]))})},onRemove:function e(t){return r.setState({textFilters:r.state.textFilters.filter(function(e){return e!==t})})},onSearchIdUpdate:function e(t){return r.setState({searchId:t})},resourceOptions:u}),y.a.createElement(G,{resourceOptions:u,scrollContainer:window,searchId:r.state.searchId})))))))},a=n,f(r,a)}return m(t,e),t.prototype.componentDidMount=function e(){var t=this,n=this.props,r=n.isAnimated,a=n.inDenzelModal,o=n.initialCropArea,i=n.contextLog,s=n.pin,c=n.productImageIndex,l=n.replaceState;if(a&&(this._previousView=v.a.getInstance().getViewFromContext(),this._origUrl=window.location.href,Z.a.instance.publish("site","unhideModal",null)),!o){var p=pe({initialCropArea:o,pin:s,productImageIndex:c});l(ce(p,s.id,c))}r&&(this._animationTimer=setTimeout(function(){t.setState({animationState:"finished"})},400)),i(13,{view:72,viewParameter:3050,viewData:{pin_id:s.id}})},t.prototype.componentWillReceiveProps=function e(t){Q()(t.initialCropArea,this.props.initialCropArea)||this.setState({textFilters:[],searchId:""})},t.prototype.componentWillUnmount=function e(){var t=this.props,n=t.inDenzelModal,r=t.replaceState;this._animationTimer&&clearTimeout(this._animationTimer),n&&(this._previousView&&v.a.getInstance().addViewToContext(this._previousView),window.location.href.indexOf("/visual-search/")>0&&r(this._origUrl))},t.prototype.renderContent=function e(){var t=this;if(this.context.userAgent.isMobile)return this.renderContentForMobile();var n=this.props,r=n.pin,a=n.productImageIndex,o=n.initialCropArea,i=n.inDenzelModal,s=n.inPureReact,c=n.isAnimated,l=n.showAsModal,p=le({pin:r,productImageIndex:a}),u=p.width,h=p.height,d=p.url,f=this.state,m=f.animationState,g=f.searchId,v=f.textFilters,w=pe({initialCropArea:o,pin:r,productImageIndex:a}),C=this.getResourceOptions(w,u,h),x={position:"absolute",top:0,bottom:0,left:0,right:0,width:"inherit",height:"inherit"},O=s?l:i,E={pageContainer:Object.assign({},x,{top:O?0:64,left:30,right:30,overflow:"hidden",textAlign:"center"}),header:Object.assign({},x,{height:80,display:"flex"}),annotationList:{margin:"30px 50px 0 295px",flex:1,display:"flex",alignItems:"flex-start"},content:Object.assign({},x,{top:80,marginTop:5,textAlign:"left"}),cropper:Object.assign({},x,{width:u+20,overflow:"auto",marginBottom:20,left:"initial"===m?"calc(50% - "+parseInt(u/2,10)+"px)":0,transition:"left 400ms"}),result:Object.assign({},x,{left:u+20,overflow:"auto",paddingRight:20})};return y.a.createElement($.a,{view:72,objectId:g},y.a.createElement("div",{className:"CloseupFlashlight",style:E.pageContainer},y.a.createElement("div",{className:b()("flashlightHeaderContainer FlashlightHeader",{noDisplay:"finished"!==m}),style:E.header},y.a.createElement("div",{className:"closeupFlashlightTitle"},U.a._("Visually similar results")),y.a.createElement("div",{style:E.annotationList},y.a.createElement(A,{onAdd:function e(n){return t.setState({textFilters:te()(v.concat([n]))})},onRemove:function e(n){return t.setState({textFilters:v.filter(function(e){return e!==n})})},onSearchIdUpdate:function e(n){return t.setState({searchId:n})},resourceOptions:C}))),y.a.createElement("div",{className:"flashlightContentContainer",style:E.content},y.a.createElement("div",{className:"flashlightImageContainer",style:E.cropper},y.a.createElement("div",{className:"FlashlightEnabledImage",style:{width:u,height:h}},y.a.createElement(j.t,{height:h,shape:"rounded",width:u},y.a.createElement(F,{imageSize:{h:h,w:u},initialCropArea:w,isAnimated:c,onChange:this.handleCropperChange,spotlightAreas:r.visual_objects}),y.a.createElement(K.a,{alt:r.description,className:"pinImage rounded",src:d,width:u})))),y.a.createElement("div",{className:b()("flashlightResultsContainer",{invisible:"finished"!==m}),ref:function e(n){t.resultScrollContainer=n},style:E.result},this.resultScrollContainer&&y.a.createElement(G,{inDenzelModal:i,resourceOptions:C,scrollContainer:this.resultScrollContainer,searchId:g})))))},t.prototype.render=function e(){var t=this.props,n=t.showAsModal,r=t.goBack,a=t.inDenzelModal,o=t.inPureReact,i=this.renderContent();return a?i:n?y.a.createElement(ne.b,{goBack:r,pageHeightStyle:o?"extend":"none"},y.a.createElement(ne.a,null,i)):i},t}(g.Component);ue.contextTypes={userAgent:O.a.shape({isMobile:O.a.bool.isRequired}).isRequired};var he=t.a=Object(_.compose)(E.a,Object(M.b)({name:"PinResource",key:"pin",options:function e(t){return{id:t.pinId,field_set_key:"detailed",fetch_visual_search_objects:!0}}}))(function(e){var t=e.resourceLoaded,n=h(e,["resourceLoaded"]);return y.a.createElement(j.b,null,t&&y.a.createElement(ue,n),y.a.createElement(j.D,{accessibilityLabel:U.a._("Loading visual search...","Accessibility label for loading visual search page"),show:!t}))})}});